
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="csrf-token" content="G839t4ifxBdhvuagnMTDyquAaPrFhPmi8ed2aW2g" />

        <title>Painel El&eacute;trico CC | RELLE - Ambiente de Aprendizagem com Experimentos Remotos
        </title>

        <link href="http://relle.ufsc.br/css/app.css" rel="stylesheet">
        <link href="http://relle.ufsc.br/css/style.css" rel="stylesheet">
        <link href="http://relle.ufsc.br/css/btn.css" rel="stylesheet">
        <link href="http://relle.ufsc.br/css/jasny-bootstrap.css" rel="stylesheet">
        <link href="http://relle.ufsc.br/css/select.min.css" rel="stylesheet">
        <link href="http://relle.ufsc.br/css/switch.css" rel="stylesheet">


        <link rel="shortcut icon" type="image/x-icon" href="http://relle.ufsc.br/favicon.png"/> 
        <link href="//gitcdn.github.io/bootstrap-toggle/2.2.0/css/bootstrap-toggle.min.css" rel="stylesheet">
        <!-- Fonts -->
        <link href='//fonts.googleapis.com/css?family=Roboto:400,300' rel='stylesheet' type='text/css'>
        <link href='//cdn.jsdelivr.net/jquery.roundslider/1.0/roundslider.min.css' rel="stylesheet">
        <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css"/>
        <!-- jQuery -->
        <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
        <link href="exp_style.css" rel="stylesheet">
        <script src="exp_script.js"></script>




        <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
        <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
        <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
                <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
        <![endif]-->
    </head>
    <body>
        <nav class="navbar navbar-default navbar-fixed-top">
            <div class="container">
                <div class="navbar-header">
                    <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#nav1">
                        <span class="sr-only">Toggle Navigation</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                    <a class="navbar-brand" href="http://relle.ufsc.br">
                        <img src="http://relle.ufsc.br/img/logos/logo.png" height="40px" />
                    </a>
                </div>
                <div class="collapse navbar-collapse" id='nav1'>
                    <ul class="nav navbar-nav">
                        <!--<li><a href="http://relle.ufsc.br">﻿In&iacute;cio</a></li>-->
                        <li><a href="http://relle.ufsc.br/labs">Experimentos</a></li>
                        <li><a href="http://relle.ufsc.br/moodle/?lang=pt_br">Moodle</a></li>
                        <li><a href="http://relle.ufsc.br/tutorial">Tutoriais</a></li>

                        <li><a href="http://rexlab.ufsc.br/gt-mre" target="_target">GT-MRE</a></li>
                        <li><a href="http://relle.ufsc.br/contact">Contato</a></li>
                        <!--
                        <li><a href="﻿http://relle.ufsc.br/sobre">Sobre</a></li>
                        <li><a href="http://relle.ufsc.br/contato">Contato</a></li>
                        -->      
                        <li class="visible-xs"><a href="http://relle.ufsc.br/login">Entrar</a></li>
                    </ul>


                    <ul class="nav navbar-nav navbar-right visible-lg visible-md visible-sm">
                        <li><a style='padding-right:0; padding-left:5px;' href="http://relle.ufsc.br/en"><img src="http://relle.ufsc.br/img/en.png"></a></li>
                        <li><a style='padding-right:0; padding-left:5px;' href="#"><img src="http://relle.ufsc.br/img/pt.png"></a></li>
                    </ul>
                    <ul class="nav navbar-nav navbar-right visible-lg visible-md visible-sm">
                        <ul class="nav navbar-nav navbar-right">
                            <li><a href="http://relle.ufsc.br/login">Entrar</a></li>
                        </ul>


                        <ul class="nav navbar-nav navbar-right visible-lg visible-md">

                            <li style='margin-top: 10px; display: none; ' id='search_bar'>
                                <form method="POST" action="http://relle.ufsc.br/labs" accept-charset="UTF-8" class="navbar-form"><input name="_token" type="hidden" value="G839t4ifxBdhvuagnMTDyquAaPrFhPmi8ed2aW2g">
                                    <div class="form-group has-feedback">
                                        <input type="text" name="terms" id='search' placeholder="Busca" class="form-control" />
                                    </div>
                                </form>
                            </li>
                            <li>
                                <a href="#" id='search_btn'><span class="glyphicon glyphicon-search"></span></a>
                            </li>
                        </ul>
                </div>
            </div>    
        </nav>
        <div id='content'>
            <div class="container">
                <div class="row">

                    <h1></h1>

                    <div id='identifier'></div>
                    <div id='close'></div>
                    <div id='return'></div>
                    <div id='error'></div>

                    <div id='DivExp' class="container">
                        <center>
                            <h1>Painel Elétrico CC</h1>

                            <div class="row">
                                <div class="col-lg-6 col-md-6 col-sm-6 col-xs-12" >

                                    <img src='http://relle.ufsc.br:8072' width="100%"/> <!-- esta na rede interna 10.10.10.178:8081 --><br><br>
                                    <div class='row'>
                                        <div class='col-lg-2 col-lg-offset-2 col-md-3 col-sm-3 col-xs-3'>
                                            <input class='switch' id='sw0' type="checkbox" data-toggle="toggle" data-on="S1" data-off="S1"/><br>
                                            <input class='switch' id='sw1' type="checkbox" data-toggle="toggle" data-on="S2" data-off="S2"/><br>
                                        </div>
                                        <div class='col-lg-2 col-md-3 col-sm-3 col-xs-3'>
                                            <input class='switch' id='sw2' type="checkbox" data-toggle="toggle" data-on="S3" data-off="S3"/><br>
                                            <input class='switch' id='sw3' type="checkbox" data-toggle="toggle" data-on="S4" data-off="S4"/><br>
                                        </div>
                                        <div class='col-lg-2 col-md-3 col-sm-3 col-xs-3'>
                                            <input class='switch' id='sw4' type="checkbox" data-toggle="toggle" data-on="S5" data-off="S5"/><br>
                                            <input class='switch' id='sw5' type="checkbox" data-toggle="toggle" data-on="S6" data-off="S6"/><br>
                                        </div>
                                        <div class='col-lg-2 col-md-3 col-sm-3 col-xs-3'>
                                            <input class='switch' id='sw6' type="checkbox" data-toggle="toggle" data-on="S7" data-off="S7"/><br>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-lg-6 col-md-6 col-sm-6 col-xs-12">
                                    <p style="display: none;" class="default_circuit">Este circuito equivalente não foi definido ainda.</p>
                                    <img class="img-responsive default_circuit" src="http://relle.ufsc.br/exp_data/1/img/diagrama.png" width="100%"/>
                                    <img style="display: none;" class="equivalent" src="" width="80%"/>
                                    <div id="sensors">
                                        <table class="table table-condensed" style='font-size:11px'>
                                            <thead>
                                                <tr>
                                                    <th>A1</th>
                                                    <th>A2</th>
                                                    <th>A3</th>
                                                    <th>A4</th>
                                                    <th>A5</th>
                                                    <th>A6</th>
                                                    <th>A7</th>
                                                    <th>V1</th>
                                                    <th>V2</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr>
                                                    <td style='font-size:9pt' id="a0">0</td>
                                                    <td style='font-size:9pt' id="a1">0</td>
                                                    <td style='font-size:9pt' id="a2">0</td>
                                                    <td style='font-size:9pt' id="a3">0</td>
                                                    <td style='font-size:9pt' id="a4">0</td>
                                                    <td style='font-size:9pt' id="a5">0</td>
                                                    <td style='font-size:9pt' id="a6">0</td>
                                                    <td style='font-size:9pt' id="v0">0</td>
                                                    <td style='font-size:9pt' id="v1">0</td>

                                                </tr>

                                            </tbody>
                                        </table>  
                                    </div>
                                    <div id="report"></div>         
                                </div>
                            </div>
                            <!-- Begin Explanation -->
                            <div class="row" style='margin:10px 0 10px 0'>
                                <div class="lab-box col-lg-6 col-md-6 col-sm-6 col-xs-12 ">                    <div class="row">
                                        <div class="col-lg-2 col-md-2 col-sm-2 col-xs-2"><img src="http://relle.ufsc.br/exp_data/oque.png"/></div>
                                        <div class="col-lg-10 col-md-10 col-sm-10 col-xs-10"><p align="justify">O caminho que a eletricidade percorre altera as propriedades do circuito. Em caminhos contínuos o circuito está em série e em caminhos alternativos está em paralelo.</div>
                                    </div>
                                </div>
                                <div class="lab-box col-lg-6 col-md-6 col-sm-6 col-xs-12 ">
                                    <div class="row">
                                        <div class="col-lg-2 col-md-2 col-sm-2 col-xs-2"><img src="http://relle.ufsc.br/exp_data/como.png"/></div>
                                        <div class="col-lg-10 col-md-10 col-sm-10 col-xs-10"> <p align="justify">Acione as chaves na imagem para configurar o circuito. 
                                                Acesse o Moodle para o <a href="http://relle.ufsc.br/moodle/course/view.php?id=56" target="_blank">Ensino Médio</a> e para o <a href="http://relle.ufsc.br/moodle/course/view.php?id=57" target="_blank">Ensino Superior</a>. 
                                                Baixe o 
                                                <a href="http://relle.ufsc.br/doc/CC.pdf" target='_blank'>Material Didático</a> e o 
                                                <a href="http://relle.ufsc.br/doc/CC_tec.pdf" target='_blank'>Manual Técnico</a>.
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </center>
                    </div>

                    <div id="leave"></div> 
                </div>
            </div>
        </div>
        <footer>

            <a href="http://www.rnp.br" target='_blank'><img src='http://relle.ufsc.br/img/footer/rnp.png'></a>
            <a href="http://www.capes.gov.br" target='_blank'><img src='http://relle.ufsc.br/img/footer/capes.png'></a>
            <a href="http://rexlab.ufsc.br/gt-mre" target='_blank'><img style="height: 40px" src='http://relle.ufsc.br/img/footer/gtmre.png'></a>
            <a href="http://rexlab.ufsc.br/" target='_blank'><img src='http://relle.ufsc.br/img/footer/r.png'></a>
            <a href="http://ufsc.br/" target='_blank'><img src='http://relle.ufsc.br/img/footer/ufsc.png'></a>
        </footer>
    </body>

    <script src="//cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.1/js/bootstrap.min.js"></script>
    <script src="//code.jquery.com/ui/1.11.4/jquery-ui.min.js"></script>
    <script src="http://relle.ufsc.br/js/jasny-bootstrap.js"></script>
    <script src="http://relle.ufsc.br/js/select.min.js"></script>
    <script src="http://relle.ufsc.br/js/jquery.redirect.js"></script>
    <script src="http://relle.ufsc.br/js/switch.js"></script>
    <script src="//gitcdn.github.io/bootstrap-toggle/2.2.0/js/bootstrap-toggle.min.js"></script>
    <script src='//cdn.jsdelivr.net/jquery.roundslider/1.0/roundslider.min.js'></script>
    <script>
        $.ajaxSetup({
            headers: {
                'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')
            }
        });
        $(function () {
            $('.selectpicker').selectpicker();

            $('#search_btn').click(function (e) {
                $('#search_bar').toggle('slide', {direction: 'right'}, 500);
            });
        });

    </script>
    <script>
        (function (i, s, o, g, r, a, m) {
            i['GoogleAnalyticsObject'] = r;
            i[r] = i[r] || function () {
                (i[r].q = i[r].q || []).push(arguments)
            }, i[r].l = 1 * new Date();
            a = s.createElement(o),
                    m = s.getElementsByTagName(o)[0];
            a.async = 1;
            a.src = g;
            m.parentNode.insertBefore(a, m)
        })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');

        ga('create', 'UA-66969703-1', 'auto');
        ga('send', 'pageview');

        (function (h, o, t, j, a, r) {
            h.hj = h.hj || function () {
                (h.hj.q = h.hj.q || []).push(arguments)
            };
            h._hjSettings = {hjid: 82466, hjsv: 5};
            a = o.getElementsByTagName('head')[0];
            r = o.createElement('script');
            r.async = 1;
            r.src = t + h._hjSettings.hjid + j + h._hjSettings.hjsv;
            a.appendChild(r);
        })(window, document, '//static.hotjar.com/c/hotjar-', '.js?sv=');


    </script>

    <script>
        $("#link").click(function () {
            $("#embeed").show().select();
        });
        $("#playvideo").click(function () {
            $("#thumbnail").hide();
            $("#video").show();
        });
        $.ajaxSetup({
            headers: {'X-CSRF-Token': $('meta[name=csrf-token]').attr('content')}
        });

        function log_entry() {
            var json = {
                user_id: '0',
                lab_id: '1'
            };
            $.ajax({
                type: "POST",
                url: "http://relle.ufsc.br/log/put",
                data: json
            });
        }
    </script>




    <script>
        var url = 'http://relle.ufsc.br/exp_data/1';
        var html = url + "/pt.html";
        var js = url + '/exp_script.js';
        var css = url + '/exp_style.css';
        var urlqueue = 'http://' + window.location.hostname + '/api/';
        var duration = parseInt('8');
        var exp_id = parseInt('1');
        var close_message = "<p> Sua sess&atilde;o chegou ao fim.</p> <p>Voc&ecirc; ser&aacute; redirecionado em alguns instantes.</p><br>";
        var rep = '';
        var popup = '';
        function loadLab(data) {

            $('#pre_experiment').remove();
            log_entry();
            $('#error').html("");
            $('head').append('<link rel="stylesheet" href=' + css + ' type="text/css" />');
            $('#return').css('margin-top', '-3%');
            $('#return').css('margin-bottom', '3%');
            $('#return').addClass('well well-sm');
            $('#return').html('<button id="btnLeave" class="btn btn-sm btn-default" name="leave">Sair</button>' +
                    "Tempo restante: " + "<span id='min'>" + data.clock.min + "</span>:<span id='seg'>" + data.clock.seg + "</span>");
            $('#exp').load(html, function () {

                $.getScript(js);
                $.getScript("/js/queue.js", function () {
                    refresh = setInterval(RefreshTimeAlive, 5000); // Intervalo para refresh da fila (5 em 5 segundos deve mandar um POST para identificar que usuario continua conectado)  
                    setTimeout(LeaveExperiment, duration * 60 * 1000); // Agenda a execucao da funcao que envia um POST com action de deixar experimento
                    timer = setInterval(TimerMinus, 1000); // Refresh do contador visual

                    $("#btnLeave").click(function () {
                        $('#exp').hide();
                        $('#return').remove();
                        var end = 'Sua sess&atilde;o terminou. Clique em &quot;Sair&quot; para deixar esta p&aacute;gina.';
                        if ($('#report').length != 0) {
                            popup = '<div class="alert alert-info" role="alert"><strong>Aten&ccedil;&atilde;o, </strong>habilite os pop-ups para emiss&atilde;o de rel&aacute;t&oacute;rios.</div>';
                            rep = '<input class="btn" onClick="report(1)" type="button"  value="Gerar Relat&oacute;rio"/>';
                            end = 'Sua sess&atilde;o terminou. Clique em &quot;Gerar Relat&oacute;rio&quot; para baixar um documento com os resultados da experi&ecirc;ncia ou clique em &quot;Sair&quot; para deixar esta p&aacute;gina.';
                        }
                        if ($('#csv').length != 0) {
                            popup = '<div class="alert alert-info" role="alert"><strong>Aten&ccedil;&atilde;o, </strong>habilite os pop-ups para emiss&atilde;o de rel&aacute;t&oacute;rios.</div>';
                            console.log("csv ok");
                            rep += ' <input class="btn" onClick="exportcsv()" type="button"  value="Exportar arquivo CSV"/>';
                        }

                        $('#leave').replaceWith(
                                popup +
                                '<div class="well">' +
                                '<center>' +
                                end +
                                '<br><br>' +
                                '<input class="btn" onClick="LeaveExperiment()" type="button"  value="Sair"/>' +
                                rep +
                                '</center>' +
                                '</div>'
                                );
                    });
                });
                //$('#report').append('<input class="btn" onClick="report(1)" type="button"  value="Gerar Relat&oacute;rio">');
                $("#exp").find('img').each(function () {
                    if ($(this).prop("src").indexOf("exp_data") == -1 && $(this).prop("src").indexOf("relle") > 0) {
                        var url = $(this).prop("src");
                        console.log('!:' + url);
                        var right = url.replace('http://relle.ufsc.br/labs', 'http://relle.ufsc.br/exp_data/1');
                        $(this).attr('src', right);
                    }
                });
            });
        }



        function waitLab(data) {
            $('#error').html("");
            $('#return').html("");
            if (data.clock.min <= 0 || data.clock.seg <= 0) {
                data.clock.min = data.clock.seg = 0;
            } else {
                $('#error').append(
                        "<div class='alert alert-warning alert-dismissible'>" +
                        "<button id='btnLeave' class='btn btn-warning btn-sm' name='leave'>Sair</button>&nbsp;&nbsp;" +
                        "<div class='col-xs-4'>" +
                        "<strong>Usu&aacute;rio(s) esperando: </strong><span id='nwait'>" + data.wait + " </span>&nbsp;&nbsp;" +
                        "</div><div class='col-xs-4'>" +
                        "<strong>Tempo restante: </strong>" +
                        "<span id='min'>" + data.clock.min + "</span>:<span id='seg'>" + data.clock.seg + "</span>" +
                        '</div>' +
                        '</div>');
            }
            $("#access").css("display", "none");
            $.getScript("/js/queue.js", function () {
                refresh = setInterval(Refresh, 1);
                timer = setInterval(TimerMinus, 1000);
                $("#btnLeave").click(LeaveExperiment);
            });
        }

        function errorLab() {
            $('#error').html("");
            $('#error').html(
                    "<div class='alert alert-warning alert-dismissible'>" +
                    '<button id="btnLeave" class="btn btn-warning btn-sm" name="leave">Sair</button>' +
                    "<button type='button' class='close' data-dismiss='alert' aria-label='Close'><span aria-hidden='true'>&times;</span></button>" +
                    "﻿Este experimento j&aacute; encontra-se aberto em outra aba. Caso contr&aacute;rio, clique em sair. Se o problema persistir, contate o administrador na aba Contato" +
                    '</div>'
                    );
            $.getScript("/js/queue.js", function () {
                $("#btnLeave").click(LeaveExperiment);
            });
        }



        $("#access").click(function () {
            $("#access").off();
            var json = {'exp_id': exp_id,
                'pass': $('meta[name=csrf-token]').attr('content'),
                'exec_time': duration};
            $.ajax({
                type: "POST",
                url: urlqueue + "queue",
                data: json,
                success: function (data) {
                    data = $.parseJSON(data);
                    if (data['message'] == 'first') {
                        loadLab(data);
                    } else if (data.wait) {
                        waitLab(data);
                    } else {
                        errorLab();
                    }
                },
                error: function (XMLHttpRequest, textStatus, errorThrown) {
                    errorLab();
                }

            });
        });

    </script>

</html>
